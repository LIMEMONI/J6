<!DOCTYPE html>
<html lang="en">
<head>
    <title>Mainㅣ FALP Service</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="/static/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/vendor/linearicons/style.css">
    <link rel="stylesheet" href="/static/vendor/chartist/css/chartist-custom.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
    <link rel="stylesheet" href="/static/css/demo.css">
    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
    <!-- ICONS -->
    <link rel="apple-touch-icon" sizes="76x76" href="/static/img/j6.png">
    <link rel="icon" type="image/png" sizes="76x76" href="static/img/top-icon.png">
    <!-- D3.js 라이브러리 추가 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/js/slimscroll.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/02c33e7f68.js" crossorigin="anonymous"></script>
    
    <style>
        /* Google Fonts에서 가져온 Roboto 폰트를 적용 */
        #sidebar-nav {
            font-family: 'Roboto', sans-serif;
            font-size: 20px;
        }
    
        /* Nav 내의 리스트 아이템에 적용된 스타일 변경 */
        #sidebar-nav li {
            list-style: none;
            margin: 10px 0;
        }
    
        #sidebar-nav a {
            text-decoration: none;
            color: #fff; /* 글자 색상 설정 */
            transition: color 0.3s; /* 색상 변경 시 부드러운 전환 효과 */
        }
    
        #sidebar-nav a:hover {
            color: #007bff; /* 마우스 호버 시 글자 색상 변경 */
        }
    </style>
    <style>
        /* 알람 갯수를 표시하는 숫자 스타일 */
        .alarm-count-badge {
            position: absolute;
            top: 18px;
            right: 5px;
            background-color: red;
            color: white;
            width: 20px; /* 숫자 너비 조정 */
            height: 15px; /* 숫자 높이 조정 */
            border-radius: 50%;
            font-size: 10px; /* 숫자 크기 조정 */
            text-align: center; /* 가운데 정렬을 위한 설정 */
            line-height: 15px; /* 숫자 높이와 같도록 설정 */
        }
    </style>
    <script type="text/Javascript">
        function goDetail_1(){
            fm = document.getElementById('fm')
            
        }
    </script>
<!-- Main 추가 된 내용 -->
<script>
    // JavaScript로 설정한 시작 시간으로부터 1초씩 시간을 증가시키는 함수
    function startCountingRuntime(startTime, elementId) {
        const startTimeObj = new Date(startTime);
        setInterval(function() {
            startTimeObj.setSeconds(startTimeObj.getSeconds() + 1); // 1초를 더합니다.
            const hours = startTimeObj.getUTCHours();
            const minutes = startTimeObj.getUTCMinutes();
            const seconds = startTimeObj.getUTCSeconds();
            document.getElementById(elementId).textContent = `${hours}시간 ${minutes}분 ${seconds}초`;
        }, 1000);
    }
    // 페이지가 로드된 후 함수 실행 
    // 4초마다 새로운 데이터를 db에서 가져오는 함수
    window.onload = function() {
        // 4초마다 함수 실행
        setInterval(async function(){
            let response = await fetch("/main.html");
            let text = await response.text();
            document.body.innerHTML = text; // 화면 갱신
        }, 4000); // 4초 간격
    };

    // 시작 시간과 element ID를 전달하여 가동시간 증가 카운트 시작
    startCountingRuntime("{{ start_times['설비 1'] }}", "tool1_runtime");
    startCountingRuntime("{{ start_times['설비 2'] }}", "tool2_runtime");
    startCountingRuntime("{{ start_times['설비 2'] }}", "tool3_runtime");
    startCountingRuntime("{{ start_times['설비 2'] }}", "tool4_runtime");
</script>

    

<style>
    .panel{
        color: gray;
        width: 500px;
        height: 200px;
        margin-left: 100px;
    }

    .panel-heading{
        color:black;
    }
    .wall{
        background-color: #392f31;
        width: 500px;
        height: 40px;
        margin-left: 100px;
        margin-bottom: 28px;
    }

    .head-line{
        margin-top: 0%; 
        margin-bottom: 0%; 
        height: 10px; 
        border: none; 
        border-top: 2px solid #565454;
    }

    .normal-status-topRight {
        width: 16px;
        height: 16px;
        border-top-left-radius: 50%;
        border-top-right-radius: 50%;
        border-bottom-right-radius: 50%;
        border-bottom-left-radius: 50%;
        border: 2px solid #CCC;
        margin-bottom: 2px;
        background-color: green;
        position: absolute;
        right: 4%; /* 원 모양의 상태 표시를 오른쪽 끝으로 이동 */
    }

    .abnormal-status-topRight{
        width: 16px;
        height: 16px;
        border-top-left-radius: 50%;
        border-top-right-radius: 50%;
        border-bottom-right-radius: 50%;
        border-bottom-left-radius: 50%;
        border: 2px solid #CCC;
        margin-bottom: 2px;
        background-color: red;
        position: absolute;
        right: 4%; /* 원 모양의 상태 표시를 오른쪽 끝으로 이동 */
    }
</style>
</head>

<body>
    <!-- WRAPPER -->
    <div id="wrapper">
        <!-- NAVBAR -->
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <!-- 로고와 데이터 불러오기 버튼 -->
                <div class="navbar-header">
                    <a class="navbar-brand"><img src="static/img/logo2.png" alt="J6 Logo" class="img-responsive logo" style="width: 250px;"></a>
                </div>
                <!-- 오른쪽 메뉴 아이콘들 -->                
                <div id="navbar-menu">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle icon-me  nu" data-toggle="dropdown" id="alarmDropdownButton">
                                <i class="lnr lnr-alarm"></i>
                            </a>
                        <!-- 알람 드롭다운 메뉴 -->
                        <ul class="dropdown-menu notifications">
                            {% for item in bar_lis[:5] %}
                                {% set val = item[0] %}
                                {% set i_s = item[1] %}
                                {% set i_e = item[2] %}
                                <li><a class="notification-item" href="/alram.html?time={{ val }}&xlim_s={{ i_s }}&xlim_e={{ i_e }}">이상근접구간 : {{ val }}</a></li>
                            {% endfor %}
                            <li><a class="view-more" style="text-align: center;"><i class="lnr lnr-alarm"></i> 더 보기</a></li>
                        </ul>
                        <span class="alarm-count-badge">{{ bar_lis|length }}</span>
                        </li>
                        <!-- 파일 업로드 모달 대화 상자 -->
                        <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="uploadModalLabel">CSV 파일 불러오기</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="uploadForm" enctype="multipart/form-data">
                                            <div class="form-group">
                                                <label for="csvFile">CSV 파일 선택</label>
                                                <input type="file" class="form-control-file" id="csvFile" name="file">
                                            </div>
                                        </form>
                                    </div>
                                    <!-- 모달 내용 -->
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                                        <!-- 파일 업로드 버튼을 눌렀을 때 데이터를 업로드하는 함수 호출 -->
                                        <button type="button" class="btn btn-primary" id="uploadButton" onclick="uploadFile()">불러오기</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 나머지 메뉴 아이콘들 -->
                        <li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="static/img/user.png" class="img-circle" alt="Avatar">
                                <!--여기서 계정의 이름이 연결되어야 함-->
                                <span>User</span> <i class="icon-submenu lnr lnr-chevron-down"></i>
                            </a>

                            <li><a href="javascript:void(0);" onclick="logout()"><i class="lnr lnr-exit"></i> <span>Logout</span></a></li>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- END NAVBAR -->
        
        <!-- MAIN CONTENT -->
        <div class="main-content">
           <div class="container-fluid">  
              <h3 class="page-title"></h3>
                   <br>
                   <ul>
                   <h3><b>J6_Fab Abnormal Detecting & life expectancy prediction System</b></h3>
                   
                   </ul>
                   <br>
              <div class="row">
                 <div class="col-md-6">
                    <!-- BASIC TABLE -->
               <!-- 예시 코드: main.html에서 설비 클릭 시 해당 설비 정보를 dashboard.html로 전달 -->
                               <div class="panel" id="Ion_Miller_M01" 
                               style = "{% if tool1_status == 1 %} background-color: #93db93; 
                               {% elif tool1_status == 2 %}background-color: #fcee67;
                               {% elif tool1_status == 0 %}background-color: #f26464
                               {% endif %}">
                                   <a href="dashboard.html?tab=dashboard1" style="color: #392f31;"> <!-- M01설비의 Dashboard 페이지로 이동 -->
                                       <div class="panel-heading">
                                           <span class="normal-status-topRight">&nbsp</span> <!--상태표시 원-->
                                           <h3 class="panel-title"><b>Ion_Miller_M01</b></h3>
                                       </div>
                                       <hr class= "head-line"> <!--설비 이름-내용 구분선-->
                                       <div class="panel-body">
                                           <b>
                                               - 고장 여부:
                                               {% if tool1_status != 0 %}
                                               정상
                                               {% else %}
                                               <a style="color: rgb(37, 208, 227);">고장!</a>
                                               {% endif %}
                                               <br>
           
                                               - 예측 수리 시간: --
                                               <br>
                                               고장상태 : {{tool1_status}},{{tool1_status_index}},
                                               <br>
                                               잔여시간 : {{tool1_rul}},{{tool1_rul_index}}
                                               <br>
                                               장비이름 : {{tool1_name}}, lot : {{tool1_lot}}
                                               <br>
                                               - 가동시간: 
                                               {% if  tool1_status != 0 %}
                                               <span id="tool1_runtime"></span>
                                               {% else %}
                                               --
                                               {% endif %}
                                           <br>

                                           - Lot: {{Lots[0]}}
                                           </b>
                                       </div>
                                   </a>
                               </div>
                    <!-- END BASIC TABLE -->
                 </div>
                 <div class="col-md-6">
                    <!-- BASIC TABLE -->
                    <div class="panel" 
                           style = "{% if tool2_status == 1 %} background-color: #93db93;
                           {% elif tool2_status == 2 %}background-color: #fcee67;
                           {% elif tool2_status == 0 %}background-color: #f26464
                           {% endif %}">
                               <a href="dashboard.html?tab=dashboard2" style="color: #392f31;"> <!-- M02설비의 Dashboard 페이지로 이동 -->
                       <div class="panel-heading">
                                   <span class="normal-status-topRight">&nbsp</span> <!--상태표시 원-->
                          <h3 class="panel-title"><b>Ion_Miller_M02</b></h3> <!--설비 이름-->
                       </div>
                               <hr class= "head-line"> <!--설비 이름-내용 구분선-->
                       <div class="panel-body">
                                   <b>
                                       - 고장 여부:
                                       {% if tool2_status != 0 %}
                                       정상
                                       {% else %}
                                       <a style="color: rgb(37, 208, 227);">고장!</a>
                                       {% endif %}
                                       <br>
   
                                       - 예측 수리 시간: --
                                       <br>
                                       {{tool1_data_combined}}
   
                                       - 가동시간: 
                                       {% if  tool2_status != 0 %}
                                       <span id="tool2_runtime"></span>
                                       {% else %}
                                       --
                                       {% endif %}
                                   <br>
                                   - Lot: {{Lots[1]}}
                                   </b>

                       </div>
                    </div>
                    <!-- END BASIC TABLE -->
                 </div>
              </div>
                   <div class="row">
                       <div class="col-md-6">
                           <div class="wall"> <a onclick="return false;"></a></div>
                       </div>
                       <div class="col-md-6">
                           <div class="wall"><a onclick="return false;"></a></div>
                       </div>
                   </div>
                   
              <div class="row">
                 <div class="col-md-6">
                    <!-- TABLE STRIPED -->
                    <div class="panel"
                           style = 
                           "{% if tool3_status == 1 %} background-color: #93db93; 
                           {% elif tool3_status == 2 %}background-color: #fcee67;
                           {% elif tool3_status == 0 %}background-color: #f26464
                           {% endif %}">
                           <a href="dashboard.html?tab=dashboard3" style="color: #392f31;"> <!-- M03설비의 Dashboard 페이지로 이동 -->
                       <div class="panel-heading">
                                   <span class="normal-status-topRight">&nbsp</span> <!--상태표시 원-->
                          <h3 class="panel-title"><b>Ion_Miller_M03</b></h3>
                       </div>
                               <hr class= "head-line"> <!--설비 이름-내용 구분선-->
                       <div class="panel-body">
                                   <b>
                                       - 고장 여부:
                                       {% if tool3_status != 0 %}
                                       정상
                                       {% else %}
                                       <a style="color: rgb(37, 208, 227);">고장!</a>
                                       {% endif %}
                                       <br>
   
                                       - 예측 수리 시간: --
                                       <br>
   
                                       - 가동시간: 
                                       {% if  tool3_status != 0 %}
                                       <span id="tool3_runtime"></span>
                                       {% else %}
                                       --
                                       {% endif %}
                                   <br>

                                   - Lot: {{Lots[2]}}
                                   </b>
                       </div>
                    </div>
                    <!-- END TABLE STRIPED -->
                 </div>
                 <div class="col-md-6">
                    <!-- TABLE HOVER -->
                    <div class="panel"
                           style = 
                           "{% if tool4_status == 1 %} background-color: #93db93; 
                           {% elif tool4_status == 2 %}background-color: #fcee67;
                           {% elif tool4_status == 0 %}background-color: #f26464
                           {% endif %}">
                           <a href="dashboard.html?tab=dashboard4"> <!-- M04설비의 Dashboard 페이지로 이동 -->
                       <div class="panel-heading">
                                   <span class="abnormal-status-topRight">&nbsp</span> <!--상태표시 원-->
                          <h3 class="panel-title"><b>Ion_Miller_M04</b></h3>
                       </div>
                               <hr class= "head-line"> <!--설비 이름-내용 구분선-->
                       <div class="panel-body">
                                   <b style="color: black;">
                          - 고장 여부:
                                   {% if tool4_status != 0 %}
                                   정상
                                   {% else %}
                                   <a style="color: rgb(37, 208, 227);">고장!</a>
                                   {% endif %}
                                   <br>

                                   - 예측 수리 시간: --
                                   <br>

                                   - 가동시간: 
                                   {% if  tool4_status != 0 %}
                                   <span id="tool4_runtime"></span>
                                   {% else %}
                                   --
                                   {% endif %}
       
                                   <br>

                                   - Lot: {{Lots[3]}}
                                   </b>
                       </div>
                    </div>
                    <!-- END TABLE HOVER -->
                 </div>
              </div>
           </div>
        </div>
        <!-- END MAIN CONTENT -->
      </div>
      <!-- END MAIN -->
      <div class="clearfix"></div>
      <footer>
         <div class="container-fluid">
            <p class="copyright">Made by <i class="fa fa-love"></i><a>J6</a></p>
         </div>
      </footer>
   </div>
   <!-- END WRAPPER -->
   <!-- Javascript -->
   <script>
      function logout() {
          // 서버로 로그아웃 요청을 보내기 위해 fetch 사용
          fetch('/logout', {
              method: 'POST'
          })
          .then(response => {
              if (response.redirected) {
                  // 로그아웃 후, 홈 페이지로 리디렉션
                  window.location.href = response.url;
              }
          })
          .catch(error => {
              console.error('로그아웃 오류:', error);
          });
      }
  </script>
   <script src="/static/vendor/jquery/jquery.min.js"></script>
   <script src="/static/vendor/bootstrap/js/bootstrap.min.js"></script>
   <script src="/static/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
   <script src="/static/scripts/klorofil-common.js"></script>
    
    <script>
        $(document).ready(function() {
            // 알람 드롭다운 메뉴를 토글하기
            $("#alarmDropdownButton").click(function() {
                $(".notifications").toggle();
            });

            // "더 보기" 버튼을 클릭했을 때 이벤트 처리
            $(".view-more").click(function() {
                // "alram.html"로 이동
                window.location.href = "alram.html";
            });
        });
    </script>

</body>
</html>